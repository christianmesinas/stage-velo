<!DOCTYPE html>
<html lang="{{ language }}">
<head>
  <meta charset="UTF-8">
  <title>{% block title %}Velo App{% endblock %}</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
  {% block head %}{% endblock %}
</head>
<body>

<header>
  <a href="{{ url_for('routes.index') }}"><div class="logo"><img src="{{ url_for('static', filename='images/LOGO2.png') }}" alt="vrouw op fiets" width="100" height="50"></div></a>

  <nav class="nav-links">
    <a href="#">{{ _('Hoe het werkt') }}</a>
    <a href="{{ url_for('routes.tarieven') }}">{{ _('Tarieven') }}</a>
    <a href="{{ url_for('routes.markers') }}">{{ _('Vind een fiets') }}</a>
    <a href="#">{{ _('Help') }}</a>
    <a href="#footer">{{ _('Contact') }}</a>
    <div class="dropdown">
      <a href="#">{{ _('Meer ▼') }}</a>
      <div class="dropdown-menu">
        <a href="{{ url_for('routes.defect') }}">{{ _('Fiets defect?') }}</a><br>
        <a href="#">{{ _('optie 2') }}</a>
      </div>
    </div>
    <div class="language-selector">
      <select id="language-selector" onchange="changeLanguage()" aria-label="{{ _('Selecteer taal') }}">
        <option value="nl" {% if language == 'nl' %}selected{% endif %}>{{ _('Nederlands ▼') }}</option>
        <option value="en" {% if language == 'en' %}selected{% endif %}>{{ _('English ▼') }}</option>
        <option value="fr" {% if language == 'fr' %}selected{% endif %}>{{ _('Français ▼') }}</option>
        <option value="es" {% if language == 'es' %}selected{% endif %}>{{ _('Español ▼') }}</option>
        <option value="de" {% if language == 'de' %}selected{% endif %}>{{ _('Deutsch ▼') }}</option>
      </select>
    </div>
  </nav>

  <div class="nav-buttons">
    {% if user %}
      <a href="{{ url_for('routes.profile') }}" class="profile">{{ _('Profiel') }}</a>
      <a href="{{ url_for('routes.logout') }}" class="logout">{{ _('Uitloggen') }}</a>
    {% else %}
      <a href="{{ url_for('routes.login') }}" class="login">{{ _('Inloggen') }}</a>
      <a href="{{ url_for('routes.login') }}" class="register">{{ _('Account aanmaken') }}</a>
    {% endif %}
  </div>
</header>

<main>
  {% block content %}{% endblock %}
</main>

<script>
  // Synchroniseer de taalselector met de huidige taal
  document.addEventListener('DOMContentLoaded', () => {
    const url = new URL(window.location.href);
    const langFromUrl = url.searchParams.get('lang');
    const serverLanguage = "{{ language | safe }}";
    const selector = document.getElementById('language-selector');
    if (selector) {
      // Geef prioriteit aan URL-queryparameter, anders server-language
      const selectedLanguage = langFromUrl || serverLanguage || 'nl';
      selector.value = selectedLanguage;
      console.log(`Setting language selector to: ${selectedLanguage}`);
    }
  });

  function changeLanguage() {
    const language = document.getElementById('language-selector').value;
    const currentUrl = window.location.href;
    const url = new URL(currentUrl);
    url.searchParams.set('lang', language);
    window.location.href = url.toString();
  }
</script>

{% block scripts %}{% endblock %}

</body>
</html>