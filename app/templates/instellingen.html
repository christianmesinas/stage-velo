{% extends "base.html" %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/instellingen.css') }}">
<style>
  .settings-wrapper {
    max-width: 700px;
    margin: 4rem auto;
    padding: 2.5rem;
    background-color: white;
    border-radius: 1rem;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
  }

  body.dark-mode .settings-wrapper {
    background-color: #1f1f1f;
    color: #f0f0f0;
  }

  .form-title {
    text-align: center;
    font-weight: bold;
    margin-bottom: 1.5rem;
  }

  .return-button {
    max-width: 700px;
    margin: 2rem auto 0 auto;
    padding-left: 2.5rem;
  }

  .alert {
    animation: fadeIn 0.4s ease;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
  }
</style>
{% endblock %}

{% block content %}
<div class="return-button">
  <a href="{{ url_for('routes.profile') }}" class="btn">← Terug naar profiel</a>
</div>

<div class="settings-wrapper">
  <h2 class="form-title">Instellingen</h2>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="mb-4">
        {% for category, message in messages %}
          <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <form method="POST" action="{{ url_for('routes.instellingen') }}">
    <div class="mb-3">
      <label for="titel" class="form-label">Aanspreekvorm</label>
      <select class="form-select" id="titel" name="titel" autocomplete="honorific-prefix">
        <option value="" {% if not user.titel %}selected{% endif %}>...</option>
        <option value="heer" {% if user.titel == 'heer' %}selected{% endif %}>Heer</option>
        <option value="vrouw" {% if user.titel == 'vrouw' %}selected{% endif %}>Vrouw</option>
      </select>
    </div>

    <div class="mb-3">
      <label for="voornaam" class="form-label">Voornaam</label>
      <input type="text" class="form-control" id="voornaam" name="voornaam" autocomplete="given-name" value="{{ user.voornaam or '' }}">
    </div>

    <div class="mb-3">
      <label for="achternaam" class="form-label">Achternaam</label>
      <input type="text" class="form-control" id="achternaam" name="achternaam" autocomplete="family-name" value="{{ user.achternaam or '' }}">
    </div>

    <div class="mb-3">
      <label for="telefoonnummer" class="form-label">Telefoonnummer</label>
      <input type="tel" class="form-control" id="telefoonnummer" name="telefoonnummer"
             pattern="^(0|\+)[1-9][0-9]{7,14}$"
             title="Voer een geldig telefoonnummer in. Begin met 0 of +, gevolgd door 8 tot 15 cijfers. Geen spaties of symbolen."
             autocomplete="tel"
             value="{{ user.telefoonnummer or '' }}">
      <div class="form-text text-danger">
        Bijv. 0478123456 of +32478123456 (geen spaties of leestekens)
      </div>
    </div>

    <div class="mb-4">
      <label for="email" class="form-label">E-mailadres</label>
      <input type="email" class="form-control" id="email" name="email"
             pattern="^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$"
             title="Voer een geldig e-mailadres in, bv. naam@example.com"
             required
             autocomplete="email"
             value="{{ user.email or '' }}">
      <div class="form-text text-danger">Bijv. naam@example.com</div>
    </div>

    <div class="d-flex justify-content-between button-group">
      <button type="submit" class="btn">Opslaan</button>
      <a href="{{ url_for('routes.profile') }}" class="btn">Annuleren</a>
    </div>
  </form>

  <hr class="my-4">

  <form method="POST" action="{{ url_for('routes.delete_account') }}">
    <button type="submit" class="danger-button"
            onclick="return confirm('Weet u zeker dat u uw account permanent wilt verwijderen?')">
      Verwijder account
    </button>
  </form>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', () => {
  const form = document.querySelector('form[action="{{ url_for('routes.instellingen') }}"]');

  form.addEventListener('submit', function (e) {
    const requiredFields = [
      { id: 'voornaam', label: 'voornaam' },
      { id: 'achternaam', label: 'achternaam' },
      { id: 'email', label: 'e-mailadres' }
    ];

    let fouten = [];

    requiredFields.forEach(field => {
      const input = document.getElementById(field.id);
      if (!input.value.trim()) {
        fouten.push(`• Vul het veld '${field.label}' in.`);
      } else if (!input.checkValidity()) {
        fouten.push(`• Ongeldige invoer bij '${field.label}'.`);
      }
    });

    if (fouten.length > 0) {
      e.preventDefault(); // voorkom dat formulier wordt verzonden
      alert("Foutmelding:\n\n" + fouten.join("\n"));
    }
  });
});
</script>
{% endblock %}
