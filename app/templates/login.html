{% extends "base.html" %}

{% block head %}
<script src="https://cdn.auth0.com/js/lock/11.30/lock.min.js"></script>

<link rel="stylesheet" href="{{ url_for('static', filename='css/login.css') }}">
{% endblock %}

{% block content %}


<h1>welkom op de login test</h1>
<h2>dees is een testje voor git branches</h2>


<div id="auth0-login-box"></div>

{% endblock %}






{% block scripts %}


<!-- Auth0 Script (NE PAS TOUCHER) -->
  <script>
    var lock = new Auth0Lock('{{ auth0_client_id }}', '{{ auth0_domain }}', {
      container: "auth0-login-box",
      auth: {
        redirect: false,

        responseType: 'token id_token',

        params: {
          scope: 'openid profile email',
          audience: 'https://dev-b522ltua566kmhdh.us.auth0.com/api/v2/',


        }
      },
      allowedConnections: ['Username-Password-Authentication', 'google-oauth2', 'facebook', 'apple'],


      theme: {
        primaryColor: '#000000',
        backgroundColor: '#000000',
        logo: 'LOGO'
      },
      languageDictionary: {
        title: "Logo.png"
      },
      allowSignUp: true,
      allowLogin: true,
      closable: false
    });

    lock.show();

lock.on("authenticated", function(authResult) {
  console.log("‚úÖ Ingelogd:", authResult);

  lock.getUserInfo(authResult.accessToken, function(error, profile) {
    if (error) {
      console.error("‚ùå Fout bij ophalen profiel:", error);
      return;
    }

    console.log("üë§ Gebruiker:", profile);

    // üîÅ Stuur access token naar je Flask backend
    fetch("/auth/process", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        access_token: authResult.accessToken
      })
    }).then((res) => {
      if (res.ok) {
        // ‚úÖ Succes! Ga door naar beveiligde pagina
        window.location.href = "/profile";

      } else {
        console.error("‚ùå Backend verwerkte token niet correct");
      }
    });
  });
});


    function logout() {
      localStorage.removeItem("accessToken");
      window.location.reload();
    }
  </script>

{% endblock %}


