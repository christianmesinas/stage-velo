{% extends 'base_admin.html' %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/live_data.css') }}">
{% endblock %}

{% block content %}
<h2 class="dashboard-header">ðŸš² Live Data Fietsstations (Antwerpen)</h2>

<div class="stats-grid">
  <div class="stat-card">
    <h3>Totaal aantal stations</h3>
    <p>{{ stations|length }}</p>
  </div>

  <div class="stat-card">
    <h3>Totaal aantal fietsen</h3>
    <p>
      {% set totaal = 0 %}
      {% for s in stations %}
        {# gebruik default(0) als 'free_bikes' ontbreekt #}
        {% set totaal = totaal + (s['free_bikes']|default(0)) %}
      {% endfor %}
      {{ totaal }}
    </p>
  </div>

  <div class="stat-card">
    <h3>Totaal aantal lege slots</h3>
    <p>
      {% set totaal = 0 %}
      {% for s in stations %}
        {% set totaal = totaal + (s['empty_slots']|default(0)) %}
      {% endfor %}
      {{ totaal }}
    </p>
  </div>

  <div class="stat-card">
    <h3>Totaal capaciteit</h3>
    <p>
      {% set totaal = 0 %}
      {% for s in stations %}
        {% set totaal = totaal + (s['capacity']|default(0)) %}
      {% endfor %}
      {{ totaal }}
    </p>
  </div>
</div>

<div class="table-container">
  <table class="fixed-header-table">
    <thead>
      <tr>
        <th>Naam</th>
        <th>Adres</th>
        <th>Status</th>
        <th>Beschikbaar</th>
        <th>Lege slots</th>
        <th>Capaciteit</th>
      </tr>
    </thead>
  </table>

  <div class="scrollbox">
    <table class="fixed-header-table">
      <tbody>
        {% for s in stations %}
        <tr>
          <td>{{ s['name']|default('â€”') }}</td>
          <td>
            {# als adres in nested dict staat, gebruik safe lookup; anders lege string #}
            {% if s.get('extra') and s['extra'].get('address') %}
              {{ s['extra']['address'] }}
            {% else %}
              {{ s['address']|default('â€”') }}
            {% endif %}
          </td>
          <td>{{ s['status']|default('â€”') }}</td>
          <td>{{ s['free_bikes']|default(0) }}</td>
          <td>{{ s['empty_slots']|default(0) }}</td>
          <td>{{ s['capacity']|default(0) }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<div class="stat-card5" style="max-width: 400px; margin-bottom: 2rem;">
  <h3>ðŸ”¥ Populairste station vandaag</h3>
  <p style="font-size: 1.4rem; color: #2c3e50;">
    {{ populairste_station.naam|default('â€”') }}<br>
    <small style="color: #999;">
      {{ populairste_station.ritten|default(0) }} ritten gestart
    </small>
  </p>
</div>
{% endblock %}
